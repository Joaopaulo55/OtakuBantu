<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>OtakuBantu - Anime Educacional</title>
  <style>
    body {
      background: #0d1117;
      color: #c9d1d9;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    input, button {
      padding: 10px;
      border-radius: 5px;
      border: none;
      margin-right: 10px;
    }
    .anime {
      margin: 10px 0;
      padding: 10px;
      background: #161b22;
      border-radius: 8px;
    }
    iframe {
      width: 100%;
      height: 360px;
      border: none;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <h1>OtakuBantu</h1>
  <div id="status">Verificando API...</div>

  <br><hr><br>

  <h2>游댌 Buscar anime por nome:</h2>
  <input type="text" id="searchInput" placeholder="Digite o nome do anime">
  <button onclick="buscarAnime()">Buscar</button>

  <h2>游댠 Animes Populares:</h2>
  <div id="popular"></div>

  <h2>游닠 Epis칩dio Selecionado:</h2>
  <div id="player"></div>

  <script>
    const API_BASE = "https://consumet-api-fawn.vercel.app/anime/gogoanime";

    // Verifica a API
    fetch(API_BASE)
      .then(res => res.json())
      .then(data => {
        document.getElementById("status").innerText = "JP\n\n" + JSON.stringify(data, null, 2);
        carregarPopulares();
      })
      .catch(() => {
        document.getElementById("status").innerText = "Epha n칚o 칠 hoje";
      });

    // Buscar anime por nome
    function buscarAnime() {
      const nome = document.getElementById("searchInput").value.trim();
      if (!nome) return alert("Digite um nome");

      fetch(`${API_BASE}/${encodeURIComponent(nome)}`)
        .then(res => res.json())
        .then(animes => {
          const container = document.getElementById("popular");
          container.innerHTML = "<h3>Resultados da busca:</h3>";
          animes.results.forEach(anime => {
            const div = document.createElement("div");
            div.className = "anime";
            div.innerHTML = `
              <strong>${anime.title}</strong><br>
              <img src="${anime.image}" width="120"><br>
              <button onclick="assistirAnime('${anime.episodes[0]?.id}')">Assistir 1췈 Epis칩dio</button>
            `;
            container.appendChild(div);
          });
        })
        .catch(err => {
          alert("Erro ao buscar anime");
          console.error(err);
        });
    }

    // Carregar populares
    function carregarPopulares() {
      fetch(`${API_BASE}/popular`)
        .then(res => res.json())
        .then(animes => {
          const container = document.getElementById("popular");
          container.innerHTML = "<h3>Mais populares:</h3>";
          animes.results.forEach(anime => {
            const div = document.createElement("div");
            div.className = "anime";
            div.innerHTML = `
              <strong>${anime.title}</strong><br>
              <img src="${anime.image}" width="120"><br>
              <button onclick="assistirAnime('${anime.episodes[0]?.id}')">Assistir 1췈 Epis칩dio</button>
            `;
            container.appendChild(div);
          });
        })
        .catch(console.error);
    }

    // Assistir epis칩dio
    function assistirAnime(episodeId) {
      if (!episodeId) return alert("Epis칩dio n칚o dispon칤vel");
      fetch(`${API_BASE}/watch/${episodeId}`)
        .then(res => res.json())
        .then(data => {
          const videoUrl = data.sources.find(src => src.quality === "default" || src.quality === "720p")?.url || data.sources[0]?.url;
          if (!videoUrl) {
            document.getElementById("player").innerText = "V칤deo n칚o dispon칤vel.";
            return;
          }
          document.getElementById("player").innerHTML = `<iframe src="${videoUrl}" allowfullscreen></iframe>`;
        })
        .catch(err => {
          document.getElementById("player").innerText = "Erro ao carregar epis칩dio.";
          console.error(err);
        });
    }
  </script>

</body>
</html>
